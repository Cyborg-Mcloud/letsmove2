<!DOCTYPE html>
<html lang="en">
  <head>


	<meta http-equiv=“Pragma” content=”no-cache”>
	<meta http-equiv=“Expires” content=”-1″>
	<meta http-equiv=“CACHE-CONTROL” content=”NO-CACHE”>
	<meta name="viewport" content="width=365, initial-scale=1">
	<meta charset="UTF-8">
	
		 
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://connect.facebook.net https://developers.facebook.com https://maps.googleapis.com 'unsafe-inline' 'unsafe-eval'; default-src *; img-src 'self' https://maps.googleapis.com/ https://maps.gstatic.com https://smartgps.ge https://www.smartgps.ge 'unsafe-inline' 'unsafe-eval' 'unsafe-hashes' ; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; ">
  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>LetsMove2</title>
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>


	

<script type="text/javascript" charset="utf-8" src="main.js"></script>
<script type="text/javascript" charset="utf-8" src="gps.js"></script>
<script type="text/javascript" charset="utf-8" src="login.js"></script>
<script type="text/javascript" charset="utf-8" src="map.js"></script>
<script type="text/javascript" charset="utf-8" src="func.js"></script>
  </head>

  <link rel="stylesheet" href="styles.css">
		
	<style>


	*{
		-webkit-transition-property: none!important;
		transition-property: none!important;
		/* These doesn't affect anything, but, just in case. */
		-webkit-animation: none!important;
		animation: none!important;
	}

	
	a {text-decoration:none; color:white;}
	body { background-color:#242834; padding:0; border:0; margin:0; color:#ebebeb;}
  </style>
  <body >


	<div id='loading_screen' style='width:100%; height:100%; position:absolute; left:0px; top:0px;'>
		<center>
		<Br><br><br><Br><br><br>
		<img src='icon_1024.png' style='width:90%;'>
		
		<div id='infodiv2' style='color:red; '></div>
		<div id='infodiv' style='color:red; display:none;'></div>
	</div>



	<div id='home_screen' style='display:none; width:100%; height:100%; position:absolute; left:0px; top:0px;'>
		<div style='background-color:#113356; height:87px; width:100%; position:absolute; right:0px; bottom:0px; z-index:101;' >
			<div style='color:white; margin-left:130px; margin-top:5px;' id='pinfo'></div>
		</div>
		<a href="Javascript: back_to_home();" class="pop_left"></a>
		<div class="shape"><img src="images/shape.png"></div>
		<div class="pop_right">
			<span style="">☰</span>
			<a href='?m=profile'><img src="images/mini_foto.png">PROFILE</a>
			<a href="Javascript:show_data();">SUPPORT</a>
			<a>CHAT</a>
		</div>
	
		<div id='congrads' style='position:absolute; left 0px; top:40%; width:100%;'>
			Congradulations<Br><Br>
			You are <div id='youare'></div>
	
		</div>
	
		<div id='timer' style='position:absolute; top:60px; right:10px; z-index:1003; background-color:#4a5466; display:block; padding:7px; border-radius:50px; border:2px solid #d8a424;'>4:59</div>
	
		<div id="mymap2" style=' height:125px; width:125px; position:absolute; bottom:-20px; left:-4px; z-index:102; background-color:black;  border-radius: 0px 20px 0px 0px; border:4px solid #113356;'></div>
	
		<div id="mymap" style='height:90vh; width:100%; position:absolute; top:0px; left:0px; '></div>
	
	
	
		<a href='Javascript: mapset(1);' style='position:absolute; right:10px; bottom:110px; width:49px; height:49px;  '><img src='images/icon_onme.png' width=50px ></a>
		<a href='Javascript: mapset(2);' style='position:absolute; right:10px; bottom:160px; width:49px; height:49px; '><img src='images/icon_fit.png' width=50px></a>
		<a href='Javascript: mapset(3);' style='position:absolute; right:10px; bottom:210px; width:49px; height:49px;  '><img src='images/icon_target.png' width=50px></a>
		<a href='Javascript: grats_close();' style=' color:Red; position:absolute; right:10px; bottom:270px; display:none; ' id='show_leaderb_but'>Leaderboard</a>

	
		<div class="game_menu" id='game_menu'>
			<div class="menu_logo">
				<a><img src='images/letsmove_2.png'></a>
			</div>
			<p>Choose Game Mode</p>
			<div onclick='Javascript: change_game_mode(2);' class="campaign">
				<img src='images/campaign.png'>
				<a class="menu_title">Campaign</a>
			</div>
			<div onclick='Javascript: change_game_mode(1);' class="hot_chal">
				<img src='images/hot_challenge.png'>
				<a class="menu_title">Hot Challenge</a>
				<div id='timer2' style='background-color:#59142e; border:1px solid #b23a56; display:inline-block; border-radius:10px; padding:15px; position:absolute; font-size: 20px;left:20px; bottom:20px; z-index:500; '></div>
			</div>
			<a class="menu_pry" style='display:none;'>pry</a>
		</div>
	
		<div id='grats_div' style='display:none; position:absolute; left:0%; top:35%;width:100%; background-color:#205690;'>
		<center><Br><br>
			You have reached distination<BR><BR>
			<a href='Javascript: grats_close();'>Close</a>
			<br>
			<br><br></center>
		</div>
		
		<div id='small_grats_div' style='display:none; position:absolute; left:0%; top:35%;width:100%; background-color:#205690;'>
		<center><Br><br>
			You have taken the point<BR><BR>
			<a href='Javascript: small_grats_close();'>Next</a>
			<br>
			<br><br></center>
		</div>
		
		
		<div id='leaderboard' style='display:none; position:absolute; left:0%; top:20%; height:60%; width:100%; text-align:center;  background-color:#205690;'>
			Leaderboard
			<div id='leaderboard_txt' style='margin-top:20px; color:white; font-size:20px; text-align:left; padding-left:30px;'>
			</div>
			<a href='Javascript: leader_close();'>Close</a>
		</div>


		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFY47FE__z9AvRLBoYG0T2XeOTiHdwzOQ&callback=initMap"></script>
	</div>
 



	<div id='login_screen' style='width:100%; height:100%; position:absolute; left:0px; top:0px;'>
		<div id="fb-root"></div>

		<div style='background: rgb(30,32,43); background: linear-gradient(0deg, rgba(30,32,43,1) 0%, rgba(37,41,53,1) 100%);overflow:auto;'>
			<center>
			<div id="login_logo" class="login_logo"style=""><a><img src='images/letsmove_2.png'></a></div>
			<div id='logindiv'>

				
				<input style="background-color:#d2d4d9 !important;"class="log_inp" type="email" placeholder="Email" name='email' id='email'>
				<input class="log_inp"type="password" placeholder="Password" name='pass' id='pass'>
				<a href='Javascript: forgotten();' style='color: #ebebeb;'>პაროლი</a>
				<br>
				<a href='Javascript: signin();'class="log_faceb" style='background: rgb(43,113,89);
				background: linear-gradient(8deg, rgba(43,113,89,1) 0%, rgba(72,133,156,1) 86%);'><!--<img src='sign_in.png' width=250px>--> SIGN IN</a>
			
				<a href='Javascript: mylogin();'class="log_faceb" style="color: #ebebeb; line-height:2.5; background: rgb(59,52,126); background: linear-gradient(8deg, rgba(59,52,126,1) 0%, rgba(82,103,180,1) 86%);">or sign in with <br><span>FACEBOOK</span></a>
				

			<br><br>


				<a style="color: #ebebeb;">არ ხართ რეგისტრირებული?</a><Br>
				<a href='Javascript: show_reg();' class="log_faceb" style='background: rgb(97,42,56); background: linear-gradient(8deg, rgba(97,42,56,1) 0%, rgba(209,44,91,1) 86%);'><!--<img src='sign_up.png' width=250px>-->SIGN UP</a>
				<Br><Br>
				<br>
			</div>

			<div id='regdiv' class="regdiv">
				
				<input type="hidden" id="fbid" name="fbid"  >
				<input class="log_inp" type="telephone"  size='20' id="reg_tel" name="reg_tel"  placeholder="ტელეფონი">
				<input class="log_inp" type="text"   id="reg_uname" name="reg_uname" placeholder="username">
				<input class="log_inp" type="email"  id="reg_email" name="reg_email" aria-describedby="emailHelp" placeholder="ელ.ფოსტა">
				<input class="log_inp" type="password" id="reg_pass1" name="reg_pass1" placeholder="პაროლი">
				<input class="log_inp" type="password"id="reg_pass2" name ="reg_pass2"placeholder="გაიმ.პაროლი">
				<input class="log_inp" type="text" id="referal" name ="referal" placeholder="რეფერალი">
				<Br>
				<p>By clicking Sign up you agree to the following <br><a href="#">Terms and Conditions</a></p>
				<a href='Javascript: checkregform();'class="log_up" style="background: rgb(97,42,56); background: linear-gradient(8deg, rgba(97,42,56,1) 0%, rgba(209,44,91,1) 86%);">SIGN UP</a>
				
				<a href='Javascript: myreg();' id='fbregbut'class="log_up"style="color: #ebebeb; line-height:2.5; background: rgb(59,52,126); background: linear-gradient(8deg, rgba(59,52,126,1) 0%, rgba(82,103,180,1) 86%);">or sign in with <br><span>FACEBOOK</span></a>
				<Br><Br>
				<b>უკვე დარეგისტრირებული ხართ?</b><Br>
				<a href='Javascript: show_login();'class="log_up" style=' background: rgb(43,113,89);
				background: linear-gradient(8deg, rgba(43,113,89,1) 0%, rgba(72,133,156,1) 86%);'>SIGN IN</a>
			<br><br><br>
			</div>

		</div>

	</div>

  <div id='nogps' style='color:white; font-weight:bold; position:fixed; top:5px; width:100%; text-align:center;'><?echo "$mstr[no_gps]";?></div>


  <div id='acc' style='display:none; height:30px; color:black; width:50px; background-color:white; position:fixed; bottom:10px; left:10px; z-index:11000;'></div>
  <div id='acc_data' style='display:none; height:110px;  color:black;width:200px; background-color:white; position:fixed; bottom:10px; left:10px;  z-index:11000;' onclick="hide_data();">
  
	  <div style='position:absolute; left:50%;top:0px; height:30px; width:50px; background-color:red' id='xdiv'></div>
	  <div style='position:absolute; left:50%;top:30px; height:30px; width:60px; background-color:blue' id='ydiv'></div>
	  <div style='position:absolute; left:50%;top:60px; height:30px;width:70px; background-color:green' id='zdiv'></div>
  
  
	  <div style='position:absolute; left: 0px;top:0px; height:90px;  color:black;' id='txtdata'></div>
	  <div style='position:absolute; left: 0px;bottom:0px;   color:black;' id='gpsdata'></div>
	  <div style='position:absolute; right:0px;bottom:0px;  color:black;' id='time_data'></div>
	  <div style='position:absolute; left:0px;bottom:40px;  color:black;' id='accuracy_data'></div>

	  <div style='position:absolute; left:50%;top:60px; height:30px;width:70px; background-color:green' id='speeddiv'></div>
  
  </div>


  
</body>



<script>

function unid_success(uuid)
	{
	myid=uuid;
    console.log("unique id: "+uuid);
	};


function unid_fail(uuid)
	{
    console.log("fail: "+uuid);
	};


var opts = { timeout: 3000, enableHighAccuracy: true, maximumAge:0};
function onDeviceReady() 
	{



	console.log("init start");
	unid=getCookie("unid");
	if (unid==0 || unid=="")
		{
		unid=parseInt(Math.random()*10000000000)
		setCookie("unid",unid, 365);
		console.log("new unid: "+unid);
		}
	else
		{
		console.log("my unid: "+unid);
		}
	
	uid=getCookie("uid");
	if (uid!=null && uid>0)	{
		show_screen("home");
	}

	console.log("backgroundmode enable");
	cordova.plugins.backgroundMode.enable();
	cordova.plugins.backgroundMode.setEnabled(true);


//cordova.plugins.backgroundMode.setDefaults({
 //   title: "Letsmove2",
  //  text: "is running",
   // icon: 'icon', // this will look for icon.png in platforms/android/res/drawable|mipmap
    //color: "FFFFFF", // hex format like 'F14F4D'
  //  resume: true,
  //  hidden: false,
  //  bigText: false
//});



	cordova.plugins.backgroundMode.on('activate', function() {
		console.log("background mode optimizations disable");
	cordova.plugins.backgroundMode.disableWebViewOptimizations(); 
	});

	req_loc_acc();
	req_loc_auth();
	
	StatusBar.backgroundColorByHexString('#205690');
    
	
	navigator.geolocation.activator.askActivation(function(response) {
		console.log("activator");
		console.log(response);
		//Success callback
		}, function(response) {
		//Failure callback
		});

	console.log("get unieque device id");
//	cordova.plugins.uniqueDeviceID.get(unid_success, unid_fail);

	myid=device.uuid;
	console.log("device ready, getting position");

	init_gps();

	console.log("pushbots init");
	window.plugins.PushbotsPlugin.initialize("5dddf9233dcb8d26092358a5", {"android":{"sender_id":"754771780635"}});

	
	var token;
	var user_id;
	
	if (localStorage.getItem("pnotif_id") === null) 
		{
		window.plugins.PushbotsPlugin.on("registered", function(token){
		console.log("Registration Id:" + token);
		window.localStorage.setItem("pnotif_id", token);
		});
		console.log("first lounch");
		}
	else
		{
		token = window.localStorage.getItem("pnotif_id");
		console.log("mytoken: "+token);
		
		}

	window.plugins.PushbotsPlugin.on("user:ids", function(data){
		console.log("user:ids" + JSON.stringify(data));
		token=data["token"];
		window.localStorage.setItem("pnotif_id", token);
		user_id=data["userId"];
		window.localStorage.setItem("pnotifuser_id", token);


		});	

	
	var first_start=getCookie("first_start");
	if (first_start=="")
		{
		setCookie("first_start","1",365);
		setTimeout("location.reload(); ",100);	
		}

	advanced_start();
	
	
	document.removeEventListener('deviceready', onDeviceReady, false);
	setTimeout("req_players();",1000);	
	
	
    }

function advanced_start(){
	
	AdvancedGeolocation.start(advanced_success,
function(error){
console.log("ERROR! " + JSON.stringify(error));
},
{
"minTime":500,         // Min time interval between updates (ms)
"minDistance":1,       // Min distance between updates (meters)
"noWarn":true,         // Native location provider warnings
"providers":"GPS",     // Return GPS, NETWORK and CELL locations
"useCache":false,       // Return GPS and NETWORK cached locations
"satelliteData":false, // Return of GPS satellite info
"buffer":false,        // Buffer location data
"bufferSize":0,        // Max elements in buffer
"signalStrength":false // Return cell signal strength data
});

}

function advanced_success(response){

	var jsonObject = JSON.parse(response);
	console.log("advanced location");
	console.log(jsonObject);
}

function StartWebView()
	{
	var url='https://smartgps.ge/letsmove/?myid='+myid+'&lat='+MyLat+'&lng='+MyLong+"&ragacid="+Math.random()*10000000;
	console.log(url);
	//ref = cordova.InAppBrowser.open(url, '_system', 'location=no, clearcache=yes');
	window.location=url;
	}



function onRequestSuccess(success)
	{
    console.log("Successfully requested accuracy "+success.message);
	var k=success.message;
	var b=k.split("agreed");
	if (b.length>1)
		{
		// aplikaciis restarti tu motxovna gaxda sachiro da userma ok utxra
		location.reload();
		}
	
    }

function onRequestFailure(error)
	{
    console.log("Accuracy request failed: error code="+error.code+"; error message="+error.message);
	}

function req_loc_acc()
	{
	var accuracy = 3;
	var accuracyName  = "High Accuracy";
	console.log("requesting acc");
	cordova.plugins.locationAccuracy.request(onRequestSuccess, onRequestFailure, cordova.plugins.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY);
	}

function req_loc_auth()
	{
	console.log("requesting auth");
	cordova.plugins.diagnostic.isLocationAuthorized(function (authorized) {
		if(!authorized)
			{

			cordova.plugins.diagnostic.requestLocationAuthorization(function (status) {
				console.log("Requested location authorization: authorization was " + status);
				}, errorFunction, cordova.plugins.diagnostic.locationAuthorizationMode.ALWAYS);
			}
		else
			{
			errorFunction(1);
			}
		}, errorFunction);
	}


function open_loc_settings()
	{
	cordova.plugins.diagnostic.switchToLocationSettings();
	}

function successFunction()
	{	
    console.info("immersive worked!");
	}

function errorFunction(error)
	{
	console.log(error);
	if (error!=1)
		{
		req_loc_acc();
		req_loc_auth();
		}
	}


function setCookie(cname, cvalue, exdays) {
	var d = new Date();
	d.setTime(d.getTime() + (exdays*24*60*60*1000));
	var expires = "expires="+ d.toUTCString();
	document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}
function getCookie(cname) {
	var name = cname + "=";
	var decodedCookie = decodeURIComponent(document.cookie);
	var ca = decodedCookie.split(';');
	for(var i = 0; i <ca.length; i++) {
		var c = ca[i];
		while (c.charAt(0) == ' ') {
			c = c.substring(1);
		}
		if (c.indexOf(name) == 0) {
			return c.substring(name.length, c.length);
		}
	}
	return "";
}
function eraseCookie(name) {   
	document.cookie = name+'=; Max-Age=-99999999;';  
}
	

document.addEventListener("deviceready", onDeviceReady, false);



</script>

</html>
